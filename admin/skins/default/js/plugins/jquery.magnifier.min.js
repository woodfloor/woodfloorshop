(function(a){a.extend(a.fn,{magnify:function(b){return this.each(function(){var c={defaults:{lensWidth:160,lensHeight:160,link:true,delay:0},a:null,$img:null,$largeImage:null,$lens:null,$sensor:null,$loader:null,timeOut:null,largeWidth:0,largeHeight:0,init:function(d){c.options=a.extend({},c.defaults,d);c.a=this;c.$img=a("img",this);c.setLargeImage();c.setLens();c.setSensor();c.setLoader();c.loadImage();c.addHandles()},setLargeImage:function(){c.$largeImage=a(new Image());c.$largeImage.attr("src",c.a.href).css("display","none")},setLens:function(){c.$lens=a("<div id='dio-lens'></div>");c.$lens.css({width:c.options.lensWidth,height:c.options.lensHeight,visibility:"hidden",overflow:"hidden",position:"absolute",left:0,top:0}).appendTo("body")},setSensor:function(){c.$sensor=a("<div id='dio-sensor' style='position:absolute;'></div>");a("body").append(c.$sensor);if(c.options.link){c.$sensor.click(function(){a.fn.colorbox({href:c.a.href,open:true})})}},setLoader:function(){c.$loader=a("<div id='dio-loader'>loading</div>").css({width:c.options.lensWidth,height:c.options.lensHeight});c.$lens.append(c.$loader)},loadImage:function(){c.$largeImage.load(function(d){c.imgLoadCheck(c.$largeImage[0],c.loadCallback,c.errorCallback,d)})},imgLoadCheck:function(f,d,e){if(f!=null){function g(){if(f.complete){clearInterval(h);d()}}var h=setInterval(g,100)}else{e()}},loadCallback:function(){c.$lens.append(c.$largeImage);function d(){if(c.$largeImage.width()){c.largeWidth=c.$largeImage.width();c.largeHeight=c.$largeImage.height()}if(c.largeWidth){c.$loader.remove();clearInterval(e)}}var e=setInterval(d,100)},errorCallback:function(){alert("large image could not be loaded")},addHandles:function(){c.$sensor.css({width:c.$img.width()+"px",height:c.$img.height()+"px",top:c.$img.offset().top+"px",left:c.$img.offset().left+"px",backgroundColor:"#fff",opacity:"0"}).mousemove(function(d){c.handleMouseMove(d)}).mouseout(function(d){c.handleMouseOut(d)})},handleMouseMove:function(d){c.$lens.css({left:parseInt(d.pageX-(c.options.lensWidth*0.5))+"px",top:parseInt(d.pageY-(c.options.lensHeight*0.5))+"px"});if(c.options.delay){if(!c.timeOut){c.timeOut=setTimeout(function(){c.$lens.css("visibility","visible")},c.options.delay)}}else{c.$lens.css("visibility","visible")}if(c.largeWidth){c.positionLargeImage(d)}c.$lens.css("display","block")},positionLargeImage:function(g){var h={};h.x=c.largeWidth/c.$img.width();h.y=c.largeHeight/c.$img.height();var f=-h.x*Math.abs((g.pageX-c.$img.offset().left))+c.options.lensWidth/2+"px";var d=-h.y*Math.abs((g.pageY-c.$img.offset().top))+c.options.lensHeight/2+"px";c.$largeImage.css({position:"absolute",left:f,top:d,display:"block"})},handleMouseOut:function(d){if(c.timeOut){clearTimeout(c.timeOut);c.timeOut=null}c.$lens.css({visibility:"hidden",display:"none"})}};c.init.call(this,b)})}})})(jQuery);